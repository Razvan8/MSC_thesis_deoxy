fit=hierNet(X_only_main, y_all, lam=1, diagonal = FALSE, stand.main=FALSE,tol=1e-6)
#fit
y_pred_train=predict(fit,X_only_main)
#sum(fit$bp+fit$bn)
#$sum(abs(fit$th))
print(get_vec_theta_hat3(fit$th,l1=4, l2=9, l3=3))
print(fit$bp-fit$bn)
#####
####TRUTH
#beta[1]=1 #A1
#beta[4]=4 #A4
#beta[9]=9 #B5
#beta[13]=13 #B9
#beta[16]=1 #C3
#2 way
#beta[21]=2 #A1:B5
#beta[25]=2 #A1:B9
#beta[91]=9 #B9:C3
#3way
#beta[106]=1  #A1B5C3
#beta[128]=1  #A1B9C3
#####
lmd<-20
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.01)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)),l1=4,l2=9,l3=3) ## psi
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
myWeakHierNet_seq <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
lambda<-0.1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(fitted$vec_psi_hat)
print(dim(X_3way))
print(length(as.vector(coefficients(lasso_model))))
print(dim(X_3way))
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-0.1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(length(as.vector(coefficients(lasso_model)[-1])))
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_sparse_hier_dataset()
X<-data$X
y<-data$y
print(dim(X))
print(dim(y))
4+9+3+4*12+27+12*9
colnames(X)[199]
X_only_main<-X[,c(1:16)]
X_3way<-X[,c(93:199)]
y_all<-as.vector(y[,1])
y_all
###HIERNET LIBRARY
print("-----Hiernet library-----")
##On train
#fit=hierNet(X_only_main, y_all, lam=1, diagonal = FALSE, stand.main=FALSE,tol=1e-6)
#fit
#y_pred_train=predict(fit,X_only_main)
#sum(fit$bp+fit$bn)
#$sum(abs(fit$th))
#print(get_vec_theta_hat3(fit$th,l1=4, l2=9, l3=3))
#print(fit$bp-fit$bn)
#####
####TRUTH
#beta[1]=1 #A1
#beta[4]=4 #A4
#beta[9]=9 #B5
#beta[13]=13 #B9
#beta[16]=1 #C3
#2 way
#beta[21]=2 #A1:B5
#beta[25]=2 #A1:B9
#beta[91]=9 #B9:C3
#3way
#beta[106]=1  #A1B5C3
#beta[128]=1  #A1B9C3
#####
lmd<-20
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.01)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-0.1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(dim(X_3way))
print(length(psi_init))
as.vector(coefficients(lasso_model)[-1])
length(as.vector(coefficients(lasso_model)[-1]))
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_sparse_hier_dataset()
X<-data$X
y<-data$y
print(dim(X))
print(dim(y))
4+9+3+4*12+27+12*9
colnames(X)[199]
X_only_main<-X[,c(1:16)]
X_3way<-X[,c(93:199)]
y_all<-as.vector(y[,1])
y_all
###HIERNET LIBRARY
print("-----Hiernet library-----")
##On train
#fit=hierNet(X_only_main, y_all, lam=1, diagonal = FALSE, stand.main=FALSE,tol=1e-6)
#fit
#y_pred_train=predict(fit,X_only_main)
#sum(fit$bp+fit$bn)
#$sum(abs(fit$th))
#print(get_vec_theta_hat3(fit$th,l1=4, l2=9, l3=3))
#print(fit$bp-fit$bn)
#####
####TRUTH
#beta[1]=1 #A1
#beta[4]=4 #A4
#beta[9]=9 #B5
#beta[13]=13 #B9
#beta[16]=1 #C3
#2 way
#beta[21]=2 #A1:B5
#beta[25]=2 #A1:B9
#beta[91]=9 #B9:C3
#3way
#beta[106]=1  #A1B5C3
#beta[128]=1  #A1B9C3
#####
lmd<-20
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.01)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-0.1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(dim(X_3way))
colnames(X)[199]
colnames(X)[92]
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_sparse_hier_dataset()
X<-data$X
y<-data$y
print(dim(X))
print(dim(y))
4+9+3+4*12+27+12*9
colnames(X)[92]
X_only_main<-X[,c(1:16)]
X_3way<-X[,c(92:199)]
y_all<-as.vector(y[,1])
y_all
###HIERNET LIBRARY
print("-----Hiernet library-----")
##On train
#fit=hierNet(X_only_main, y_all, lam=1, diagonal = FALSE, stand.main=FALSE,tol=1e-6)
#fit
#y_pred_train=predict(fit,X_only_main)
#sum(fit$bp+fit$bn)
#$sum(abs(fit$th))
#print(get_vec_theta_hat3(fit$th,l1=4, l2=9, l3=3))
#print(fit$bp-fit$bn)
#####
####TRUTH
#beta[1]=1 #A1
#beta[4]=4 #A4
#beta[9]=9 #B5
#beta[13]=13 #B9
#beta[16]=1 #C3
#2 way
#beta[21]=2 #A1:B5
#beta[25]=2 #A1:B9
#beta[91]=9 #B9:C3
#3way
#beta[106]=1  #A1B5C3
#beta[128]=1  #A1B9C3
#####
lmd<-20
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.01)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-0.1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_sparse_hier_dataset()
X<-data$X
y<-data$y
print(dim(X))
print(dim(y))
4+9+3+4*12+27+12*9
colnames(X)[92]
X_only_main<-X[,c(1:16)]
X_3way<-X[,c(92:199)]
y_all<-as.vector(y[,1])
y_all
###HIERNET LIBRARY
print("-----Hiernet library-----")
##On train
#fit=hierNet(X_only_main, y_all, lam=1, diagonal = FALSE, stand.main=FALSE,tol=1e-6)
#fit
#y_pred_train=predict(fit,X_only_main)
#sum(fit$bp+fit$bn)
#$sum(abs(fit$th))
#print(get_vec_theta_hat3(fit$th,l1=4, l2=9, l3=3))
#print(fit$bp-fit$bn)
#####
####TRUTH
#beta[1]=1 #A1
#beta[4]=4 #A4
#beta[9]=9 #B5
#beta[13]=13 #B9
#beta[16]=1 #C3
#2 way
#beta[21]=2 #A1:B5
#beta[25]=2 #A1:B9
#beta[91]=9 #B9:C3
#3way
#beta[106]=1  #A1B5C3
#beta[128]=1  #A1B9C3
#####
lmd<-20
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.01)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-0.1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(length(as.vector(coefficients(lasso_model)[-1])))
print(dim(X_3way))
print(length(psi_init))
length(as.vector(coefficients(lasso_model)[-1]))
#print(fitted$vec_psi_hat)
print(fitted$vec_psi_hat)
lambda<-1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(fitted$vec_psi_hat)
lmd<-10
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.01)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-1
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(fitted$vec_psi_hat)
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.001)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(fitted$vec_psi_hat)
lambda<-10
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
print(fitted$vec_psi_hat)
print(r2(r_2way,fitted$predict(X_3way)))
r2(r_2way,fitted$predict(X_3way))
r2(r_2way,myWeakHierNet_seq3$predict(fitted,X_3way))
asso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=10)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=10)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
r2(r_2way,myWeakHierNet_seq3$predict(fitted,X_3way))
print(fitted$vec_psi_hat)
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_sparse_hier_dataset()
X<-data$X
y<-data$y
print(dim(X))
print(dim(y))
4+9+3+4*12+27+12*9
colnames(X)[92]
X_only_main<-X[,c(1:16)]
X_3way<-X[,c(92:199)]
y_all<-as.vector(y[,1])
y_all
###HIERNET LIBRARY
print("-----Hiernet library-----")
##On train
#fit=hierNet(X_only_main, y_all, lam=1, diagonal = FALSE, stand.main=FALSE,tol=1e-6)
#fit
#y_pred_train=predict(fit,X_only_main)
#sum(fit$bp+fit$bn)
#$sum(abs(fit$th))
#print(get_vec_theta_hat3(fit$th,l1=4, l2=9, l3=3))
#print(fit$bp-fit$bn)
#####
####TRUTH
#beta[1]=1 #A1
#beta[4]=4 #A4
#beta[9]=9 #B5
#beta[13]=13 #B9
#beta[16]=1 #C3
#2 way
#beta[21]=2 #A1:B5
#beta[25]=2 #A1:B9
#beta[91]=9 #B9:C3
#3way
#beta[106]=1  #A1B5C3  sau 106-92=14
#beta[128]=1  #A1B9C3  sau 128-92=36
#####
lmd<-10
t<-1e-3
myWeakHierNet<-WeakHierNetUnscaled (X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8)  #Increase max iter if needed or decrease tol
# Fit the model
fitted=myWeakHierNet$fit(X=X_only_main, Beta_plus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1), Beta_minus_init=matrix(0,nrow = dim(X_only_main)[2], ncol = 1),
Theta_init=matrix(0, ncol = dim(X_only_main)[2], nrow = dim(X_only_main)[2]), y=y_all, lambda=lmd, t=t, tol=1e-8,
max_iter=10000, eps=1e-8,l1=4,l2=9,l3=3 )
print(fitted$Beta_hat_plus-fitted$Beta_hat_minus)
print(fitted$vec_theta_hat)
print(fitted$Theta_hat)
print(myWeakHierNet$R2_score(fitted,X_only_main,y_all))
#Residuals
predicted<-myWeakHierNet$predict(fitted, X_only_main)
r_2way<-y_all-predicted
##Fit in on residuals
lasso_model <- glmnet(X_3way, r_2way, alpha = 1, lambda=10)
coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[-1]),l1=4,l2=9,l3=3) ## psi, get intercept out
theta_bound<-fitted$Theta_hat +t(fitted$Theta_hat) ##bound
lambda<-50
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=4,l2=9,l3=3)
# Fit the model
fitted=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=4,l2=9,l3=3)
r2(r_2way,myWeakHierNet_seq3$predict(fitted,X_3way))
print(fitted$vec_psi_hat)
data=create_sparse_hier_dataset()
