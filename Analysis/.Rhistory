library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
source(file.path(libs_path,'hierarchy_tests.R'))
source(file.path(libs_path,'helper_functions.R'))
data=create_hier_dataset_paper_many_main_vary_interactions(magnitude_scale = 0.5)
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
beta_trues
l1=6
l2=5
l3=4
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
zeros_beta_true<-sum(beta_true==0)
zeros_theta_true<-sum(theta_true==0)
zeros_psi_true<-sum(psi_true==0)
total_zeros<-zeros_beta_true+zeros_theta_true+zeros_psi_true
print(zeros_beta_true)
print(zeros_theta_true)
print(zeros_psi_true)
print(total_zeros)
print(length(beta_trues))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.3)
coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#print(coefs[range_theta])
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
source(file.path(libs_path,'hierarchy_tests.R'))
source(file.path(libs_path,'helper_functions.R'))
data=create_hier_dataset_paper_many_main_vary_interactions(magnitude_scale = 0.7)
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
beta_trues
l1=6
l2=5
l3=4
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
zeros_beta_true<-sum(beta_true==0)
zeros_theta_true<-sum(theta_true==0)
zeros_psi_true<-sum(psi_true==0)
total_zeros<-zeros_beta_true+zeros_theta_true+zeros_psi_true
print(zeros_beta_true)
print(zeros_theta_true)
print(zeros_psi_true)
print(total_zeros)
print(length(beta_trues))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
####Lasso only on main effects
#lasso_model <- glmnet(X[,range_main], y_all, alpha = 1, lambda=0.3)
#coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#all_beta_functions(beta_true, coefs[range_main])
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.3)
coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#print(coefs[range_theta])
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
test_hierarchy_layer12(coefs[range_main], get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3) )
test_hierarchy_layer23( get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3), get_psi_from_psi_vec3(coefs[range_psi],l1=l1,l2=l2,l3=l3) )
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
source(file.path(libs_path,'hierarchy_tests.R'))
source(file.path(libs_path,'helper_functions.R'))
data=create_hier_dataset_paper_many_main_vary_interactions(magnitude_scale = 1)
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
beta_trues
l1=6
l2=5
l3=4
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
zeros_beta_true<-sum(beta_true==0)
zeros_theta_true<-sum(theta_true==0)
zeros_psi_true<-sum(psi_true==0)
total_zeros<-zeros_beta_true+zeros_theta_true+zeros_psi_true
print(zeros_beta_true)
print(zeros_theta_true)
print(zeros_psi_true)
print(total_zeros)
print(length(beta_trues))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
####Lasso only on main effects
#lasso_model <- glmnet(X[,range_main], y_all, alpha = 1, lambda=0.3)
#coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#all_beta_functions(beta_true, coefs[range_main])
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.3)
coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#print(coefs[range_theta])
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
test_hierarchy_layer12(coefs[range_main], get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3) )
test_hierarchy_layer23( get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3), get_psi_from_psi_vec3(coefs[range_psi],l1=l1,l2=l2,l3=l3) )
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
source(file.path(libs_path,'hierarchy_tests.R'))
source(file.path(libs_path,'helper_functions.R'))
data=create_hier_dataset_paper_many_main_vary_interactions(magnitude_scale = 0.6)
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
beta_trues
l1=6
l2=5
l3=4
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
zeros_beta_true<-sum(beta_true==0)
zeros_theta_true<-sum(theta_true==0)
zeros_psi_true<-sum(psi_true==0)
total_zeros<-zeros_beta_true+zeros_theta_true+zeros_psi_true
print(zeros_beta_true)
print(zeros_theta_true)
print(zeros_psi_true)
print(total_zeros)
print(length(beta_trues))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
source(file.path(libs_path,'hierarchy_tests.R'))
source(file.path(libs_path,'helper_functions.R'))
data=create_hier_dataset_paper_many_main_vary_interactions(magnitude_scale = 0.5)
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
beta_trues
l1=6
l2=5
l3=4
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
zeros_beta_true<-sum(beta_true==0)
zeros_theta_true<-sum(theta_true==0)
zeros_psi_true<-sum(psi_true==0)
total_zeros<-zeros_beta_true+zeros_theta_true+zeros_psi_true
print(zeros_beta_true)
print(zeros_theta_true)
print(zeros_psi_true)
print(total_zeros)
print(length(beta_trues))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
####Lasso only on main effects
#lasso_model <- glmnet(X[,range_main], y_all, alpha = 1, lambda=0.3)
#coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#all_beta_functions(beta_true, coefs[range_main])
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.3)
coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#print(coefs[range_theta])
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
test_hierarchy_layer12(coefs[range_main], get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3) )
test_hierarchy_layer23( get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3), get_psi_from_psi_vec3(coefs[range_psi],l1=l1,l2=l2,l3=l3) )
beta_true
coefs[range_main]
sum(coefs==0)
r2(y_all, X%*%coefs + coefficients(lasso_model)[1])
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
fit=hierNet(X_only_main, y_all, lam=17, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
sum(get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)==0) + sum( (fit$bp-fit$bn) ==0)
sum( (fit$bp-fit$bn) ==0)
fit=hierNet(X_only_main, y_all, lam=20, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
sum(get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)==0) + sum( (fit$bp-fit$bn) ==0)
sum( (fit$bp-fit$bn) ==0)
fit=hierNet(X_only_main, y_all, lam=17, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
sum(get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)==0) + sum( (fit$bp-fit$bn) ==0)
theta_true
get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)
all_beta_functions(beta_true, c(fit$bp-fit$bn) )
all_beta_functions(theta_true, get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3))
r_2way<-y_all-predicted_lib
#Residuals my WHN
predicted<-myWeakHierNet$predict(fitted, X_only_main)
#Residuals their library
r_2way<-y_all-predicted_lib
lasso_model_3way <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.05)
#coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model_3way)[-1]),l1=l1,l2=l2,l3=l3) ## psi, get intercept out
print(dim(psi_init))
print(dim(X_3way))
#theta_bound<- (fitted$Theta_hat +t(fitted$Theta_hat))*5 ##bound
theta_bound<- (fit$th +t(fit$th))*5 ##bound lib
lambda<-75
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-5e-2
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted3=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
r2(r_2way,myWeakHierNet_seq3$predict(fitted3,X_3way))
sum(fitted3$vec_psi_hat==0)
r2(y_all,predicted_lib + myWeakHierNet_seq3$predict(fitted3,X_3way))
all_beta_functions(psi_true, c(fitted3$vec_psi_hat))
all_beta_functions(psi_true,coefs[range_psi])
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
sum(get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)==0) + sum( (fit$bp-fit$bn) ==0) + sum(fitted3$vec_psi_hat==0)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model_3way)[-1]),l1=l1,l2=l2,l3=l3) ## psi, get intercept out
print(dim(psi_init))
print(dim(X_3way))
#theta_bound<- (fitted$Theta_hat +t(fitted$Theta_hat))*5 ##bound
theta_bound<- (fit$th +t(fit$th))*5 ##bound lib
lambda<-80
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-5e-2
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted3=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
r2(r_2way,myWeakHierNet_seq3$predict(fitted3,X_3way))
#print(fitted$vec_psi_hat)
sum(fitted3$vec_psi_hat==0)
all_beta_functions(psi_true, c(fitted3$vec_psi_hat))
sum(fit$bp-fit$bn==0)+ sum(get_vec_theta_hat3(fit$th,l1=l1,l2=l2,l3=l3)==0)+sum(fitted3$vec_psi_hat==0)
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
source(file.path(libs_path,'hierarchy_tests.R'))
source(file.path(libs_path,'helper_functions.R'))
data=create_hier_dataset_paper_many_main_vary_interactions(magnitude_scale = 0.5)
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
beta_trues
l1=6
l2=5
l3=4
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
zeros_beta_true<-sum(beta_true==0)
zeros_theta_true<-sum(theta_true==0)
zeros_psi_true<-sum(psi_true==0)
total_zeros<-zeros_beta_true+zeros_theta_true+zeros_psi_true
print(zeros_beta_true)
print(zeros_theta_true)
print(zeros_psi_true)
print(total_zeros)
print(length(beta_trues))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
####Lasso only on main effects
#lasso_model <- glmnet(X[,range_main], y_all, alpha = 1, lambda=0.3)
#coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#all_beta_functions(beta_true, coefs[range_main])
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.3)
coefs<-coefficients(lasso_model)[-1]
#coefs
#sum(coefs==0)
#print(coefs[range_theta])
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
test_hierarchy_layer12(coefs[range_main], get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3) )
test_hierarchy_layer23( get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3), get_psi_from_psi_vec3(coefs[range_psi],l1=l1,l2=l2,l3=l3) )
lmd<-50
t<-1e-5
beta_init_lasso_plus<- beta_init_lasso
fit=hierNet(X_only_main, y_all, lam=20, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)
print("hiernet")
all_beta_functions(beta_true, c(fit$bp-fit$bn) )
all_beta_functions(theta_true, get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3))
fit=hierNet(X_only_main, y_all, lam=22, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
print("hiernet")
all_beta_functions(beta_true, c(fit$bp-fit$bn) )
all_beta_functions(theta_true, get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3))
fit=hierNet(X_only_main, y_all, lam=21, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
all_beta_functions(beta_true, c(fit$bp-fit$bn) )
all_beta_functions(theta_true, get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3))
fit=hierNet(X_only_main, y_all, lam=20, diagonal = FALSE, stand.main=FALSE,tol=1e-10, strong = FALSE)
#fit$th
predicted_lib=predict(fit,X_only_main)
print(r2(y_all, predicted_lib))
print("hiernet")
all_beta_functions(beta_true, c(fit$bp-fit$bn) )
all_beta_functions(theta_true, get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3))
r_2way<-y_all-predicted_lib
lasso_model_3way <- glmnet(X_3way, r_2way, alpha = 1, lambda=0.05)
#coefficients(lasso_model)
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model_3way)[-1]),l1=l1,l2=l2,l3=l3) ## psi, get intercept out
print(dim(psi_init))
print(dim(X_3way))
#theta_bound<- (fitted$Theta_hat +t(fitted$Theta_hat))*5 ##bound
theta_bound<- (fit$th +t(fit$th))*5 ##bound lib
lambda<-80
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-5e-2
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted3=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
r2(r_2way,myWeakHierNet_seq3$predict(fitted3,X_3way))
sum(fitted3$vec_psi_hat==0)
sum(get_vec_theta_hat3(fit$th,l1=l1, l2=l2, l3=l3)==0) + sum( (fit$bp-fit$bn) ==0) + sum(fitted3$vec_psi_hat==0)
print("r2 for WHN + SEQ2-3")
r2(y_all,predicted_lib + myWeakHierNet_seq3$predict(fitted3,X_3way))
all_beta_functions(psi_true, c(fitted3$vec_psi_hat))
lasso_main <- glmnet(X, y_all, alpha = 1, lambda=0.32)
coefs_lasso_main<-coefficients(lasso_main)[2:(l1+l2+l3+1)]
all_beta_functions(beta_true, coefs_lasso_main)#lasso main
lasso_main <- glmnet(X, y_all, alpha = 1, lambda=0.3)
coefs_lasso_main<-coefficients(lasso_main)[2:(l1+l2+l3+1)]
all_beta_functions(beta_true, coefs_lasso_main)#lasso main
beta_bound<-coefs_lasso_main*10
theta_init<-get_theta_hat_from_vec3(coefficients(lasso_main)[(l1+l2+l3+2): (l1+l2+l3+1+l1*l2+l1*l3*l2*l3)],l1=l1,l2=l2,l3=l3)*1
lmd<-50
t<-1e-2
r_main<-y_all- X_only_main%*%coefs_lasso_main -coefficients(lasso_main)[1]
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
seq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init=theta_init, y=r_main, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fit12<-seq12$fit( X=X_2way, theta_init=theta_init, y=r_main, lambda=lmd,beta_bound=beta_bound, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, fit12$vec_theta_hat)#lasso all
lmd<-40
t<-1e-2
r_main<-y_all- X_only_main%*%coefs_lasso_main -coefficients(lasso_main)[1]
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
seq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init=theta_init, y=r_main, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fit12<-seq12$fit( X=X_2way, theta_init=theta_init, y=r_main, lambda=lmd,beta_bound=beta_bound, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, fit12$vec_theta_hat)#lasso all
sum(fit12$vec_theta_hat==0)
lmd<-35
t<-1e-2
r_main<-y_all- X_only_main%*%coefs_lasso_main -coefficients(lasso_main)[1]
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
seq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init=theta_init, y=r_main, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fit12<-seq12$fit( X=X_2way, theta_init=theta_init, y=r_main, lambda=lmd,beta_bound=beta_bound, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, fit12$vec_theta_hat)#lasso all
r_2way<-r_main-seq12$predict(fit12, X_2way )
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[range_psi]),l1=l1,l2=l2,l3=l3)*0 ## psi, get intercept out
theta_bound<- (fit12$theta_hat +t(fit12$theta_hat))*5 ##bound
lambda<-75
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-5e-3
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted33=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
test_hierarchy_layer23(theta_bound, fitted33$psi_hat)
r2(r_2way,myWeakHierNet_seq3$predict(fitted33,X_3way))
all_beta_functions(psi_true, fitted33$vec_psi_hat)#lasso all
r_2way<-r_main-seq12$predict(fit12, X_2way )
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[range_psi]),l1=l1,l2=l2,l3=l3)*0 ## psi, get intercept out
theta_bound<- (fit12$theta_hat +t(fit12$theta_hat))*5 ##bound
lambda<-80
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-5e-3
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted33=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
test_hierarchy_layer23(theta_bound, fitted33$psi_hat)
r_2way<-r_main-seq12$predict(fit12, X_2way )
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[range_psi]),l1=l1,l2=l2,l3=l3)*0 ## psi, get intercept out
theta_bound<- (fit12$theta_hat +t(fit12$theta_hat))*5 ##bound
lambda<-80
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-1e-3
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted33=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
r_2way<-r_main-seq12$predict(fit12, X_2way )
psi_init<-get_psi_from_psi_vec3(as.vector(coefficients(lasso_model)[range_psi]),l1=l1,l2=l2,l3=l3)*0 ## psi, get intercept out
theta_bound<- (fit12$theta_hat +t(fit12$theta_hat))*5 ##bound
lambda<-80
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
t<-3e-3
myWeakHierNet_seq3 <- WeakHierNet_seq3(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000, eps=1e-8,
l1=l1,l2=l2,l3=l3, scale = FALSE)
# Fit the model
fitted33=myWeakHierNet_seq3$fit(X=X_3way, psi_init=psi_init, y=r_2way, theta_bound=theta_bound, lambda=lambda, t=t, tol=1e-8, max_iter=5000,
eps=1e-8,l1=l1,l2=l2,l3=l3)
test_hierarchy_layer23(theta_bound, fitted33$psi_hat)
all_beta_functions(psi_true, fitted33$vec_psi_hat)#lasso all
