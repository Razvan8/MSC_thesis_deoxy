beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
#####
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-4e-4
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
########################## ANALYSIS WITH SEQ1-2 and SEQ2-3 ###########################################################
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-4e-4
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
lmd<-10
t<-2e-4
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
t<-1e-4
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
lmd<-10
t<-5e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-1e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-4e-4
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-4e-4
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-8, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
#####
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
########################## ANALYSIS WITH SEQ1-2 and SEQ2-3 ###########################################################
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
#####
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
########################## ANALYSIS WITH SEQ1-2 and SEQ2-3 ###########################################################
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
#####
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
########################## ANALYSIS WITH SEQ1-2 and SEQ2-3 ###########################################################
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
#####
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
########################## ANALYSIS WITH SEQ1-2 and SEQ2-3 ###########################################################
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-20
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
####Sparse hierarchical simulations####
library(glmnet)
libs_path<-file.path("..","libs")
source(file.path(libs_path,'Create_synthetic_datasets.R'))
source(file.path(libs_path,'WeakHierNet_Class_corrected_unscaled.R'))
source(file.path(libs_path,'WeakHierNetSeq23_3way.R'))
data=create_hier_dataset_medium()
X<-data$X
y<-data$y$obs
beta_trues<-data$beta[-1,]  ##without intercept
#5,4,3
l1=5
l2=4
l3=3
#y
#beta_trues
range_main<-c(1: (l1+l2+l3) )
range_theta<-c( (l1+l2+l3+1) : (l1+l2+l3+l1*(l2+l3)+l2*l3) )
range_psi<-c(  (l1+l2+l3+ 1+ l1*(l2+l3)+l2*l3): (l1+l2+l3+ l1*(l2+l3)+l2*l3+l1*l2*l3) )
colnames(X)[range_main]
beta_true<-beta_trues[range_main]
theta_true<-beta_trues[range_theta]
psi_true<-beta_trues[range_psi]
print(dim(X))
print(dim(y))
dim(X)
X_only_main<-X[,range_main]
X_2way<-X[,range_theta]
X_3way<-X[,range_psi]
y_all<-as.vector(y[,1])
################################### ANALYSIS WITH LASSO ##############################################################
lasso_model <- glmnet(X, y_all, alpha = 1, lambda=0.5)
coefs<-coefficients(lasso_model)[-1]
coefs
sum(coefs==0)
all_beta_functions(beta_true, coefs[range_main])
all_beta_functions(theta_true, coefs[range_theta])
all_beta_functions(psi_true, coefs[range_psi])
#####
beta_init_lasso<-coefs[range_main]
theta_init<-get_theta_hat_from_vec3(coefs[range_theta],l1=l1,l2=l2,l3=l3)
coeffs_main<-coefs[range_main]
#theta_init<-matrix(0, ncol = dim(X_only_main)[2]
########################## ANALYSIS WITH SEQ1-2 and SEQ2-3 ###########################################################
source(file.path(libs_path,'WeakHierNetSeq12_3way.R'))
r_1way<-y_all - mean(y_all)-X[,range_main]%*%coeffs_main
#print(sum(r_1way^2))
#print(sum(r_2way^2))
beta_bound<-2*coeffs_main
lmd<-10
t<-2e-5
theta_init<-get_theta_from_theta_vec_2way3(coefs[range_theta],l1=l1,l2=l2, l3=l3)
myseq12<-WeakHierNet_seq_2way3(X=X_2way, theta_init = theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3, scale=FALSE)
fitted<-myseq12$fit(X=X_2way, theta_init= theta_init, y=r_1way, beta_bound=beta_bound, lambda=lmd, t=t, tol=1e-7, max_iter=5000, eps=1e-8,l1=l1,l2=l2,l3=l3)
all_beta_functions(theta_true, c(fitted$vec_theta_hat))
